#!/usr/bin/with-contenv bash

# link database file
if [[ -e /config/PlexRequests.sqlite ]]; then
SQL_DBASE="PlexRequests"
else
SQL_DBASE="Ombi"
fi
[[ ! -e /config/"${SQL_DBASE}".sqlite ]] && \
	> /config/"${SQL_DBASE}".sqlite
[[ -e /opt/ombi/"${SQL_DBASE}".sqlite && ! -L /opt/ombi/"${SQL_DBASE}".sqlite ]] && \
	rm /opt/ombi/"${SQL_DBASE}".sqlite
[[ ! -L /opt/ombi/"${SQL_DBASE}".sqlite ]] && \
	ln -s /config/"${SQL_DBASE}".sqlite /opt/ombi/Ombi.sqlite

# link log folder
[[ ! -d /config/logs ]] && \
	mkdir -p /config/logs
[[ -d /opt/ombi/logs && ! -L /opt/ombi/logs ]] && \
	rm -rf /opt/ombi/logs
[[ ! -L /opt/ombi/logs ]] && \
	ln -s /config/logs /opt/ombi/logs

# link backup folder
[[ ! -d /config/BackupSystem ]] && \
	mkdir -p /config/BackupSystem
[[ -d /opt/ombi/BackupSystem && ! -L /opt/ombi/BackupSystem ]] && \
	rm -rf /opt/ombi/BackupSystem
[[ ! -L /opt/BackupSystem ]] && \
	ln -s /config/BackupSystem opt/ombi/BackupSystem

# permissions
chown -R abc:abc \
	/config \
	/opt
